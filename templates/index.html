<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>D&D AI Dungeon</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <!-- menu toggle -->
  <button id="menu-toggle" class="menu-toggle"><i class="fas fa-bars"></i></button>
  <!-- side menu -->
  <div id="side-menu" class="side-menu">
    <div class="side-menu-header">
      <h1>ðŸ§™ AI Dungeon Master</h1>
    </div>
    <div class="side-menu-content">
      <button id="new-game-btn" class="side-menu-btn"><i class="fas fa-plus"></i> New Game</button>
      <button id="copy-chat-btn" class="side-menu-btn"><i class="fas fa-copy"></i> Copy Chat</button>
      <button id="add-player-btn" class="side-menu-btn"><i class="fas fa-user-plus"></i> Add Player</button>
      <button id="remove-player-btn" class="side-menu-btn hidden"><i class="fas fa-user-minus"></i> Remove Player</button>
      <button id="undoBtn" class="side-menu-btn" disabled><i class="fas fa-undo"></i> Undo</button>
      <button id="redoBtn" class="side-menu-btn" disabled><i class="fas fa-redo"></i> Redo</button>
    </div>
    <div class="side-menu-donation">
      <p>Note: Chats will not save due to the inpersistent state of the server. Render.com is graciously hosting our web app for free, so it spins down with inactivity. Please use the 'Copy Chat' button to save the chat to your clipboard and paste it somewhere to save for now. This app does not require payment and has no ads. A donation would help and possibly one day our server instance can be upgraded! Here is a secure Stripe link to donate directly to me, which would support and validate my work: <a href="https://donate.stripe.com/3cs8zU2CPecAfw4eUU" target="_blank">Donate</a></p>
      <p>Thank you,<br>-Kameon</p>
    </div>
    <div class="side-menu-footer">v1.0 â€¢ Llama-3.3-70b â€¢ Kameon</div>
  </div>

  <div class="app-wrapper">
    <div class="chat-container">
      <div class="chat-window" id="chat-window">
          <!-- Messages will go here -->
          {% if chat_history %}
              {% for message in chat_history %}
                  {% if message.role == 'assistant' %}
                  <div class="message dm-message">
                      <span class="message-sender">DM: </span>
                      <span class="message-content">{{ message.content|safe }}</span>
                  </div>
                  {% endif %}
              {% endfor %}
          {% else %}
              <!-- Fallback welcome message -->
              <div class="message dm-message">
                  <span class="message-sender">DM: </span>
                  <span class="message-content">Hello adventurer! Let's begin your quest. What is your name?</span>
              </div>
          {% endif %}
      </div>
      
      <div class="player-inputs">
          <div class="player-input" id="player1-container">
              <div class="player-label" id="player1-label">Player 1:</div>
              <input 
                  type="text" 
                  id="user-input" 
                  placeholder="Type your message..." 
                  autocomplete="off"
                  class="player-input-field"
                  autofocus
              >
              <div class="player-buttons-container">
                  <button 
                      id="send-btn" 
                      class="action-btn send-btn" 
                      title="Send message"
                      type="button"
                  >
                      ðŸ“¤
                  </button>
                  <button 
                      id="dice-player1-btn" 
                      class="action-btn dice-btn" 
                      title="Roll a die"
                      type="button"
                  >
                      ðŸŽ²
                  </button>
              </div>
          </div>
          
          <!-- Area for additional players -->
          <div id="additional-players"></div>
          <!-- Removed the formatting help message -->
      </div>
    </div>
  </div>

<!-- Load utils.js first, followed by players.js, then main.js -->
<script src="/static/utils.js"></script>
<script src="/static/players.js"></script>
<script src="/static/main.js"></script>
</body>
</html>
